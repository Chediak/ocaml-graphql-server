<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Schema (graphql-lwt.Graphql_lwt.Schema)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">graphql-lwt</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Graphql_lwt.Schema</span></h1></header><div class="doc"><p>GraphQL schema with Lwt support</p></div><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span><a href="../../../graphql/Graphql_intf/index.html#module-type-Schema">Graphql_intf.Schema</a><span class="keyword"> with </span><span class="keyword">type </span>'a <a href="../../../graphql/Graphql_intf/module-type-Schema/index.html#type-io">io</a><span class="keyword"> = </span><span class="type-var">'a</span> Lwt.t</code></span></summary><div class="spec type" id="type-io"><a href="#type-io" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'a io</code><code><span class="keyword"> = </span><span class="type-var">'a</span> Lwt.t</code><code></code></div><div class="doc"><p><code class="code">io</code> is used to abstract over asynchronous operations, e.g. <code class="code">Lwt</code> or <code class="code">Async</code>. It is used for <a href="index.html#val-io_field">io_field</a>.</p></div></div><h3>Base Types</h3><div class="spec type" id="type-schema"><a href="#type-schema" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'ctx schema</code><code></code><code></code></div><div class="doc"><p>A schema with context type <code class="code">'ctx</code>.</p></div></div><div class="spec type" id="type-field"><a href="#type-field" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('ctx, 'src) field</code><code></code><code></code></div><div class="doc"><p>A field with context type <code class="code">'ctx</code> and source type <code class="code">'src</code>.</p></div></div><div class="spec type" id="type-typ"><a href="#type-typ" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('ctx, 'src) typ</code><code></code><code></code></div><div class="doc"><p>A GraphQL type with context type <code class="code">'ctx</code> and source type <code class="code">'src</code>. Specifically, it is one of the types:</p><ul><li>Scalar (see <a href="index.html#val-scalar">scalar</a>)</li><li>Enum (see <a href="index.html#val-enum">enum</a>)</li><li>Non-null (see <a href="index.html#val-non_null">non_null</a>)</li><li>List (see <a href="index.html#val-list">list</a>)</li><li>Object (see <a href="index.html#val-obj">obj</a>)</li></ul></div></div><div class="spec type" id="type-enum_value"><a href="#type-enum_value" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'src enum_value</code><code></code><code></code></div><div class="doc"><p>A enum value with source type <code class="code">'src</code>.</p></div></div><div class="spec type" id="type-deprecated"><a href="#type-deprecated" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>deprecated</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-deprecated.NotDeprecated" class="anchored"><td class="def constructor"><a href="#type-deprecated.NotDeprecated" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">NotDeprecated</span></code></td></tr><tr id="type-deprecated.Deprecated" class="anchored"><td class="def constructor"><a href="#type-deprecated.Deprecated" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Deprecated</span><span class="keyword"> of </span>string option</code></td></tr></table><code></code></div><div class="doc"><p>Indicates whether a <a href="index.html#type-field">field</a> or <a href="index.html#type-enum_value">enum_value</a> is deprecated with an optional deprecation reason.</p></div></div><div class="spec type" id="type-variables"><a href="#type-variables" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>variables</code><code><span class="keyword"> = </span>(string<span class="keyword"> * </span><a href="../../../graphql/Graphql_parser/index.html#type-const_value">Graphql_parser.const_value</a>) list</code><code></code></div><div class="doc"><p>A association list of variable names and values. It is a superset of the type <code class="code">Yojson.Basic.json</code>.</p><pre><code class="code">(* Example *)
let variables = [
  &quot;query&quot;, `String &quot;foo&quot;;
  &quot;max_results&quot;, `Int 25;
]
</code></pre></div></div><h3>Defining Arguments</h3><p><code class="code">Arg</code> is used to construct arguments (<a href="Arg/index.html#type-arg">Arg.arg</a>), argument types (<a href="Arg/index.html#type-arg_typ">Arg.arg_typ</a>) and argument lists (<a href="Arg/index.html#type-arg_list">Arg.arg_list</a>) to be used with <a href="index.html#type-field">field</a>.</p><p>Arguments are encoded in the type system as heterogenous lists (or diff lists). The concept is quite well explained in <a href="https://drup.github.io/2016/08/02/difflists/">this blog post</a>.</p><div class="spec module" id="module-Arg"><a href="#module-Arg" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Arg/index.html">Arg</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><h3>Defining a Schema</h3><div class="spec val" id="val-schema"><a href="#val-schema" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>schema : ?&#8288;mutation_name:string <span class="keyword">&#8209;&gt;</span> ?&#8288;mutations:(<span class="type-var">'ctx</span>, unit) <a href="index.html#type-field">field</a> list <span class="keyword">&#8209;&gt;</span> ?&#8288;query_name:string <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ctx</span>, unit) <a href="index.html#type-field">field</a> list <span class="keyword">&#8209;&gt;</span> <span class="type-var">'ctx</span> <a href="index.html#type-schema">schema</a></code></div><div class="doc"><p><code class="code">schema</code> constructs a schema</p></div></div><div class="spec val" id="val-obj"><a href="#val-obj" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>obj : ?&#8288;doc:string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> fields:((<span class="type-var">'ctx</span>, <span class="type-var">'src</span> option) <a href="index.html#type-typ">typ</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ctx</span>, <span class="type-var">'src</span>) <a href="index.html#type-field">field</a> list) <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ctx</span>, <span class="type-var">'src</span> option) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">obj</code> constructs an object type. The argument to the <code class="code">fields</code>-function is the object type itself to allow for recursive objects.</p><pre><code class="code">(* Example *)
let person = Schema.(obj &quot;Person&quot;
  ~fields:(fun person -&gt; [
    field &quot;friends&quot;
      ~typ:(non_null (list (non_null person)))
      ~args:Arg.[]
      ~resolve:(fun ctx person -&gt; person.friends)
  ])
)
</code></pre></div></div><div class="spec val" id="val-field"><a href="#val-field" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>field : ?&#8288;doc:string <span class="keyword">&#8209;&gt;</span> ?&#8288;deprecated:<a href="index.html#type-deprecated">deprecated</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> typ:(<span class="type-var">'ctx</span>, <span class="type-var">'a</span>) <a href="index.html#type-typ">typ</a> <span class="keyword">&#8209;&gt;</span> args:(<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="Arg/index.html#type-arg_list">Arg.arg_list</a> <span class="keyword">&#8209;&gt;</span> resolve:(<span class="type-var">'ctx</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'src</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span>) <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ctx</span>, <span class="type-var">'src</span>) <a href="index.html#type-field">field</a></code></div><div class="doc"><p><code class="code">field name ~typ ~args ~resolve</code> constructs a field.</p><pre><code class="code">(* Example *)
let name_field = Schema.(field &quot;foo&quot;
  ~typ:(non_null string)
  ~args:Arg.[]
  ~resolve:(fun ctx src -&gt; src.foo)
)
</code></pre></div></div><div class="spec val" id="val-io_field"><a href="#val-io_field" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>io_field : ?&#8288;doc:string <span class="keyword">&#8209;&gt;</span> ?&#8288;deprecated:<a href="index.html#type-deprecated">deprecated</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> typ:(<span class="type-var">'ctx</span>, <span class="type-var">'a</span>) <a href="index.html#type-typ">typ</a> <span class="keyword">&#8209;&gt;</span> args:(<span class="type-var">'a</span> <a href="index.html#type-io">io</a>, <span class="type-var">'b</span>) <a href="Arg/index.html#type-arg_list">Arg.arg_list</a> <span class="keyword">&#8209;&gt;</span> resolve:(<span class="type-var">'ctx</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'src</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span>) <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ctx</span>, <span class="type-var">'src</span>) <a href="index.html#type-field">field</a></code></div><div class="doc"><p><code class="code">io_field</code> is identical to <code class="code">field</code>, except it expects the <code class="code">resolve</code>-function to return an <a href="index.html#type-io">io</a> value. For <code class="code">Graphql_lwt.Schema</code> this is an <code class="code">Lwt.t</code> value; for <code class="code">Graphql_async.Schema</code> it is a <code class="code">Deferred.t</code> value.</p></div></div><div class="spec val" id="val-enum"><a href="#val-enum" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>enum : ?&#8288;doc:string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> values:<span class="type-var">'a</span> <a href="index.html#type-enum_value">enum_value</a> list <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ctx</span>, <span class="type-var">'a</span> option) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">enum</code> construct a enum type with the given enum values <code class="code">values</code>.</p><pre><code class="code">(* Example *)
let color = Schema.(enum &quot;Color&quot;
   ~values:[
     enum_value &quot;RED&quot; ~value:`Red;
     enum_value &quot;BLUE&quot; ~value:`Blue;
     enum_value &quot;GREEN&quot; ~value:`Green;
   ]
 )
</code></pre></div></div><div class="spec val" id="val-enum_value"><a href="#val-enum_value" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>enum_value : ?&#8288;doc:string <span class="keyword">&#8209;&gt;</span> ?&#8288;deprecated:<a href="index.html#type-deprecated">deprecated</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> value:<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-enum_value">enum_value</a></code></div><div class="doc"><p><code class="code">enum_value</code> constructs a single enum value to be used with <code class="code">enum</code>. See <a href="index.html#val-enum">enum</a> for example usage.</p></div></div><div class="spec val" id="val-scalar"><a href="#val-scalar" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>scalar : ?&#8288;doc:string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> coerce:(<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> Yojson.Basic.json) <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ctx</span>, <span class="type-var">'a</span> option) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">scalar</code> constructs a custom scalar type that serializes to JSON with the given <code class="code">coerce</code> function.</p><pre><code class="code">(* Example *)
let uri = Schema.(scalar &quot;URI&quot;
  ~coerce:(fun uri -&gt; `String (Uri.to_string uri))
)
</code></pre></div></div><div class="spec val" id="val-list"><a href="#val-list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>list : (<span class="type-var">'ctx</span>, <span class="type-var">'src</span>) <a href="index.html#type-typ">typ</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ctx</span>, <span class="type-var">'src</span> list option) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">list typ</code> returns a list type wrapping the given <code class="code">typ</code>.</p></div></div><div class="spec val" id="val-non_null"><a href="#val-non_null" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>non_null : (<span class="type-var">'ctx</span>, <span class="type-var">'src</span> option) <a href="index.html#type-typ">typ</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ctx</span>, <span class="type-var">'src</span>) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">non_null typ</code> returns non-null type wrapping the given <code class="code">typ</code>.</p></div></div><h3>Built-In Scalar Types</h3><div class="spec val" id="val-int"><a href="#val-int" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>int : (<span class="type-var">'ctx</span>, int option) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">int</code> is the built-in int scalar type.</p></div></div><div class="spec val" id="val-string"><a href="#val-string" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>string : (<span class="type-var">'ctx</span>, string option) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">string</code> is the built-in string scalar type.</p></div></div><div class="spec val" id="val-guid"><a href="#val-guid" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>guid : (<span class="type-var">'ctx</span>, string option) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">guid</code> is the built-in ID scalar type.</p></div></div><div class="spec val" id="val-bool"><a href="#val-bool" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>bool : (<span class="type-var">'ctx</span>, bool option) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">bool</code> is the built-in boolean scalar type.</p></div></div><div class="spec val" id="val-float"><a href="#val-float" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>float : (<span class="type-var">'ctx</span>, float option) <a href="index.html#type-typ">typ</a></code></div><div class="doc"><p><code class="code">float</code> is the built-in float scalar type.</p></div></div><h3>Executing Queries</h3><div class="spec val" id="val-execute"><a href="#val-execute" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>execute : <span class="type-var">'ctx</span> <a href="index.html#type-schema">schema</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'ctx</span> <span class="keyword">&#8209;&gt;</span> ?&#8288;variables:<a href="index.html#type-variables">variables</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;operation_name:string <span class="keyword">&#8209;&gt;</span> <a href="../../../graphql/Graphql_parser/index.html#type-document">Graphql_parser.document</a> <span class="keyword">&#8209;&gt;</span> (Yojson.Basic.json, Yojson.Basic.json) Pervasives.result <a href="index.html#type-io">io</a></code></div><div class="doc"><p><code class="code">execute schema ctx variables doc</code> evaluates the <code class="code">doc</code> against <code class="code">schema</code>
with the given context <code class="code">ctx</code> and <code class="code">variables</code>.</p></div></div></details></div></body></html>